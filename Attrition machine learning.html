<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>






















    
    
    
    

  <div class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">KFold</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">chdir</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">itemgetter</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="k">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span><span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="k">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">RFE</span><span class="p">,</span> <span class="n">VarianceThreshold</span><span class="p">,</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">mutual_info_regression</span><span class="p">,</span> <span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">KBinsDiscretizer</span><span class="p">,</span> <span class="n">scale</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;C:/Users/Shuya C/Desktop/depaul/dsc540&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;attritioncleaneddata.csv&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span>
<span class="n">features</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#splite original dataset</span>
<span class="n">data_train</span><span class="p">,</span> <span class="n">data_test</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> <span class="n">target_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">imblearn</span> <span class="k">import</span> <span class="n">under_sampling</span> 
<span class="kn">from</span> <span class="nn">imblearn</span> <span class="k">import</span> <span class="n">over_sampling</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="k">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Using TensorFlow backend.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">oversampler</span><span class="o">=</span><span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Over-sample using SMOTE</span>
<span class="n">smote_train</span><span class="p">,</span> <span class="n">smote_target</span> <span class="o">=</span> <span class="n">oversampler</span><span class="o">.</span><span class="n">fit_sample</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">smote_target</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_train:&#39;</span><span class="p">,</span><span class="n">Counter</span><span class="p">(</span><span class="n">target_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;smote_target:&#39;</span><span class="p">,</span><span class="n">Counter</span><span class="p">(</span><span class="n">smote_target</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>955 1624
target_train: Counter({0: 812, 1: 143})
smote_target: Counter({0: 812, 1: 812})
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="k">import</span> <span class="n">SVMSMOTE</span> <span class="c1">#Over-sample using SVMSMOTE</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">SVMSMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">svmsmote_train</span><span class="p">,</span><span class="n">svmsmote_target</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_train</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">svmsmote_target</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;svmsmote_target:&#39;</span><span class="p">,</span><span class="n">Counter</span><span class="p">(</span><span class="n">svmsmote_target</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>955 1624
svmsmote_target: Counter({0: 812, 1: 812})
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># DecisionTreeClassifier(criterion=&#39;entropy&#39;) on original train dataset</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">scores_ACC</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC</span><span class="p">)</span>
<span class="n">scores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">rd</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df1feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df1feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;DecisionTree(entropy): Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Decision Tree Acc: 0.7495145631067961
Decision Tree AUC: 0.5901349370799011
Runtime: 0.046015024185180664
              precision    recall  f1-score   support

           0       0.85      0.85      0.85       421
           1       0.31      0.31      0.31        94

    accuracy                           0.75       515
   macro avg       0.58      0.58      0.58       515
weighted avg       0.75      0.75      0.75       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># DecisionTreeClassifier(criterion=&#39;gini&#39;) on original train dataset</span>
<span class="n">start_ts2</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clf_g</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf_g</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">scores_ACC_g</span> <span class="o">=</span> <span class="n">clf_g</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC_g</span><span class="p">)</span>
<span class="n">scores_AUC_g</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf_g</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC_g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf_g</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">e</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf_g</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">rke</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df2feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf_g</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df2feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;DecisionTree(gini): Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Decision Tree Acc: 0.7592233009708738
Decision Tree AUC: 0.566634659119624
Runtime: 0.04999876022338867
              precision    recall  f1-score   support

           0       0.84      0.87      0.85       421
           1       0.32      0.28      0.30        94

    accuracy                           0.76       515
   macro avg       0.58      0.57      0.58       515
weighted avg       0.75      0.76      0.75       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier on original train dataset</span>
<span class="n">start_ts4</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">rclf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">rclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="n">rscores_ACC</span> <span class="o">=</span> <span class="n">rclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest Acc:&#39;</span><span class="p">,</span> <span class="n">rscores_ACC</span><span class="p">)</span>
<span class="n">rscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">rclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest AUC:&#39;</span><span class="p">,</span> <span class="n">rscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">rclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">c</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">rk</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">rffeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">rffeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;RandomForest: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Random Forest Acc: 0.8330097087378641
Random Forest AUC: 0.8122631020366907
Runtime: 0.6450316905975342
              precision    recall  f1-score   support

           0       0.83      0.99      0.91       421
           1       0.79      0.12      0.20        94

    accuracy                           0.83       515
   macro avg       0.81      0.55      0.56       515
weighted avg       0.83      0.83      0.78       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gbtclf</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gbtclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="n">gbtscores_ACC</span> <span class="o">=</span> <span class="n">gbtclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting Acc:&#39;</span><span class="p">,</span> <span class="n">gbtscores_ACC</span><span class="p">)</span>
<span class="n">gbtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">gbtclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting AUC:&#39;</span><span class="p">,</span> <span class="n">gbtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">gbtclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">gb</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">r</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">gb</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">gbfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">gbfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GradientBoosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>GradientBoosting Acc: 0.8330097087378641
GradientBoosting AUC: 0.7963561934603528
Runtime: 2.1700713634490967
              precision    recall  f1-score   support

           0       0.85      0.96      0.90       421
           1       0.61      0.24      0.35        94

    accuracy                           0.83       515
   macro avg       0.73      0.60      0.63       515
weighted avg       0.81      0.83      0.80       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install xgboost
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="k">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="k">import</span> <span class="n">plot_importance</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="c1"># plot feature importance</span>
<span class="n">plot_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">max_num_features</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="c1"># top 20 most important features</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XGBClassifier-Top 20 most important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: xgboost in c:\users\shuya c\anaconda3\envs\dsc478\lib\site-packages (1.0.2)
Requirement already satisfied: numpy in c:\users\shuya c\appdata\roaming\python\python37\site-packages (from xgboost) (1.16.4)
Requirement already satisfied: scipy in c:\users\shuya c\appdata\roaming\python\python37\site-packages (from xgboost) (1.3.0)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING: You are using pip version 19.1.1, however version 20.0.2 is available.
You should consider upgrading via the &#39;python -m pip install --upgrade pip&#39; command.
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="n">scorers2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;accuracy&#39;</span> <span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">),</span> 
           <span class="s1">&#39;precision&#39;</span> <span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">precision_score</span><span class="p">),</span>
           <span class="s1">&#39;recall&#39;</span> <span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">recall_score</span><span class="p">),</span> 
           <span class="s1">&#39;f1_score&#39;</span> <span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">),</span>
           <span class="s1">&#39;roc_auc&#39;</span><span class="p">:</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># DecisionTreeClassifier, cv= 10</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">dtclf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">dtclf</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">scores_Acc</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f1</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>DecisionTree Acc: 0.75 (+/- 0.30)
DecisionTree AUC: 0.62 (+/- 0.14)
DecisionTree precision: 0.37 (+/- 0.20)
DecisionTree recall: 0.42 (+/- 0.16)
DecisionTree F1 score: 0.38 (+/- 0.14)
CV Runtime: 0.510143518447876
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier , CV=10</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">rfclf</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">rfclf</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">scores_Acc3</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc3</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc3</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC3</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC3</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC3</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision3</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision3</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision3</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall3</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall3</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall3</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f13</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f13</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f13</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RandomForest Acc: 0.86 (+/- 0.02)
RandomForest AUC: 0.81 (+/- 0.11)
RandomForest precision: 0.82 (+/- 0.26)
RandomForest recall: 0.17 (+/- 0.14)
RandomForest F1 score: 0.27 (+/- 0.21)
CV Runtime: 6.01202392578125
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier CV=10</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gbclf</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">gbclf</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#print(scores)</span>
<span class="n">scores_Acc4</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc4</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc4</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC4</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC4</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC4</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision4</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision4</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision4</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall4</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall4</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall4</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f14</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f14</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f14</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Gradient Boosting Acc: 0.84 (+/- 0.16)
Gradient Boosting AUC: 0.79 (+/- 0.16)
Gradient Boosting precision: 0.69 (+/- 0.39)
Gradient Boosting recall: 0.31 (+/- 0.32)
Gradient Boosting F1 score: 0.39 (+/- 0.34)
CV Runtime: 16.740741729736328
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># DecisionTreeClassifier use smote data</span>
<span class="n">start_ts5</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smote_train</span><span class="p">,</span> <span class="n">smote_target</span><span class="p">)</span>
<span class="n">scores_ACC</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC</span><span class="p">)</span>
<span class="n">scores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">b</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">dffeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">dffeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTE - DecisionTree: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Decision Tree Acc: 0.7475728155339806
Decision Tree AUC: 0.5832491029463789
Runtime: 0.040404319763183594
              precision    recall  f1-score   support

           0       0.85      0.84      0.85       421
           1       0.31      0.32      0.32        94

    accuracy                           0.75       515
   macro avg       0.58      0.58      0.58       515
weighted avg       0.75      0.75      0.75       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier use smote data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">rclf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">rclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smote_train</span><span class="p">,</span> <span class="n">smote_target</span><span class="p">)</span>
<span class="n">scores_ACC</span> <span class="o">=</span> <span class="n">rclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC</span><span class="p">)</span>
<span class="n">scores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">rclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">rclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">a</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTE - RandomForest: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Random Forest Acc: 0.8388349514563107
Random Forest AUC: 0.7592105928134633
Runtime: 1.5477983951568604
              precision    recall  f1-score   support

           0       0.86      0.96      0.91       421
           1       0.63      0.28      0.39        94

    accuracy                           0.84       515
   macro avg       0.75      0.62      0.65       515
weighted avg       0.82      0.84      0.81       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#feature selection using gradientboosting classifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="n">clf</span> <span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
<span class="n">sel</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>                                                         
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Wrapper Select: &#39;</span><span class="p">)</span>     
<span class="n">fit_mod</span><span class="o">=</span><span class="n">sel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>    
<span class="n">sel_idx</span><span class="o">=</span><span class="n">fit_mod</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">sel_index</span><span class="o">=</span><span class="n">sel_idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1">#print(sel_index)</span>
<span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
<span class="n">temp_idx</span><span class="o">=</span><span class="p">[]</span>
<span class="n">temp_del</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">sel_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>    
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">temp_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>                                                                       
        <span class="n">temp_del</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected=&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Features (total/selected):&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<span class="c1">#splite gradientboosting selected features </span>
<span class="n">g_feature</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span>
<span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbdata_test</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">,</span> <span class="n">gbtarget_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">g_feature</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Wrapper Select: 
Selected= [&#39;Age&#39;, &#39;DailyRate&#39;, &#39;DistanceFromHome&#39;, &#39;EmployeeNumber&#39;, &#39;EnvironmentSatisfaction&#39;, &#39;HourlyRate&#39;, &#39;JobInvolvement&#39;, &#39;JobLevel&#39;, &#39;JobSatisfaction&#39;, &#39;MonthlyIncome&#39;, &#39;MonthlyRate&#39;, &#39;NumCompaniesWorked&#39;, &#39;OverTime&#39;, &#39;StockOptionLevel&#39;, &#39;TotalWorkingYears&#39;, &#39;WorkLifeBalance&#39;, &#39;YearsAtCompany&#39;, &#39;YearsSinceLastPromotion&#39;, &#39;YearsWithCurrManager&#39;, &#39;BusinessTravel_Travel_Frequently&#39;, &#39;JobRole_Sales Executive&#39;]
Features (total/selected): 51 21
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#feature selection using random forest classifier</span>
<span class="n">r_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>              
<span class="n">r_sel</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">r_clf</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>                   
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Wrapper Select: &#39;</span><span class="p">)</span>
<span class="n">fit_rmod</span><span class="o">=</span><span class="n">r_sel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>    
<span class="n">rsel_idx</span><span class="o">=</span><span class="n">fit_rmod</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">rsel_index</span><span class="o">=</span><span class="n">rsel_idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1">#print(sel_index)</span>
<span class="n">rtemp</span><span class="o">=</span><span class="p">[]</span>
<span class="n">rtemp_idx</span><span class="o">=</span><span class="p">[]</span>
<span class="n">rtemp_del</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">rsel_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>    
        <span class="n">rtemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">rtemp_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>                                                                      
        <span class="n">rtemp_del</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected=&#39;</span><span class="p">,</span> <span class="n">rtemp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Features (total/selected):&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rtemp</span><span class="p">))</span>
<span class="n">r_feature</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="n">rtemp</span><span class="p">]</span>
<span class="n">rdata_train</span><span class="p">,</span> <span class="n">rdata_test</span><span class="p">,</span> <span class="n">rtarget_train</span><span class="p">,</span> <span class="n">rtarget_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">r_feature</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Wrapper Select: 
Selected= [&#39;Age&#39;, &#39;DailyRate&#39;, &#39;DistanceFromHome&#39;, &#39;EmployeeNumber&#39;, &#39;EnvironmentSatisfaction&#39;, &#39;HourlyRate&#39;, &#39;JobInvolvement&#39;, &#39;JobLevel&#39;, &#39;JobSatisfaction&#39;, &#39;MonthlyIncome&#39;, &#39;MonthlyRate&#39;, &#39;NumCompaniesWorked&#39;, &#39;OverTime&#39;, &#39;PercentSalaryHike&#39;, &#39;RelationshipSatisfaction&#39;, &#39;StockOptionLevel&#39;, &#39;TotalWorkingYears&#39;, &#39;TrainingTimesLastYear&#39;, &#39;WorkLifeBalance&#39;, &#39;YearsAtCompany&#39;, &#39;YearsInCurrentRole&#39;, &#39;YearsSinceLastPromotion&#39;, &#39;YearsWithCurrManager&#39;]
Features (total/selected): 51 23
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#XGB using gradientboosting selected features </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">xgbclf</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">xgbclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>   
<span class="n">scores_ACC1</span> <span class="o">=</span> <span class="n">xgbclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>                                                                                                                                                                                                                                               
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBClassifier Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC1</span><span class="p">)</span>
<span class="n">scores_AUC1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">xgbclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBClassifier AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC1</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">xgbclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)))</span>
<span class="n">Xgb2feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xgbclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">gbdata_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">Xgb2feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XGB- gradientboosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>XGBClassifier Acc: 0.9476439790575916
XGBClassifier AUC: 0.79170667610047
Runtime: 0.7987802028656006
              precision    recall  f1-score   support

           0       0.85      0.98      0.91       421
           1       0.72      0.22      0.34        94

    accuracy                           0.84       515
   macro avg       0.79      0.60      0.63       515
weighted avg       0.83      0.84      0.81       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#XGB using random forest selected features </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">xgbclf2</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">xgbclf2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rdata_train</span><span class="p">,</span> <span class="n">rtarget_train</span><span class="p">)</span>   
<span class="n">scores_ACC2</span> <span class="o">=</span> <span class="n">xgbclf2</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">rdata_test</span><span class="p">,</span> <span class="n">rtarget_test</span><span class="p">)</span>                                                                                                                                                                                                                                               
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBClassifier Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC2</span><span class="p">)</span>
<span class="n">scores_AUC2</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">rtarget_test</span><span class="p">,</span> <span class="n">xgbclf2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">rdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBClassifier AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC2</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">rtarget_test</span><span class="p">,</span> <span class="n">xgbclf2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">rdata_test</span><span class="p">)))</span>

<span class="n">Xgbfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xgbclf2</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">rdata_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">Xgbfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XGB- Random forest: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>XGBClassifier Acc: 0.8466019417475729
XGBClassifier AUC: 0.7865012381866882
Runtime: 0.45311570167541504
              precision    recall  f1-score   support

           0       0.85      0.98      0.91       421
           1       0.74      0.24      0.37        94

    accuracy                           0.85       515
   macro avg       0.80      0.61      0.64       515
weighted avg       0.83      0.85      0.81       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Ada using GB selected features </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">abgbclf</span> <span class="o">=</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">base_estimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">abgbclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>   
<span class="n">scores_ACC1a</span> <span class="o">=</span> <span class="n">abgbclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>                                                                                                                                                                                                                                               
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ada Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC1a</span><span class="p">)</span>
<span class="n">scores_AUC1a</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">abgbclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ada AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC1a</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">abgbclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)))</span>
<span class="n">agb2feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">abgbclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">gbdata_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">agb2feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ada- gradientboosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Ada Acc: 0.8774869109947644
Ada AUC: 0.8100773234952241
Runtime: 1.0714898109436035
              precision    recall  f1-score   support

           0       0.83      1.00      0.91       421
           1       1.00      0.09      0.16        94

    accuracy                           0.83       515
   macro avg       0.92      0.54      0.53       515
weighted avg       0.86      0.83      0.77       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># AdaBoostClassifier using GB selected features(cv=10)</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">a_clf</span><span class="o">=</span><span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">base_estimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">a_clf</span><span class="p">,</span><span class="n">g_feature</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#print(scores)</span>
<span class="n">scores_Acc5</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc5</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc5</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC5</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC5</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC5</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision5</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision5</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision5</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall5</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall5</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall5</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f15</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f15</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f15</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Ada Boosting Acc: 0.86 (+/- 0.02)
Ada Boosting AUC: 0.81 (+/- 0.11)
Ada Boosting precision: 0.87 (+/- 0.61)
Ada Boosting recall: 0.11 (+/- 0.12)
Ada Boosting F1 score: 0.19 (+/- 0.20)
CV Runtime: 7.323499917984009
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier CV=10 with GB selected features</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gbclf3</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">gbclf3</span><span class="p">,</span><span class="n">g_feature</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#print(scores)</span>
<span class="n">scores_Acc6</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc6</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc6</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC6</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC6</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC6</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision6</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision6</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision6</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall6</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall6</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall6</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f16</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Boosting F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f16</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f16</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Gradient Boosting Acc: 0.86 (+/- 0.03)
Gradient Boosting AUC: 0.81 (+/- 0.11)
Gradient Boosting precision: 0.66 (+/- 0.28)
Gradient Boosting recall: 0.31 (+/- 0.26)
Gradient Boosting F1 score: 0.39 (+/- 0.25)
CV Runtime: 5.753657341003418
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GB using GB selected features </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gbclf4</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gbclf4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>   
<span class="n">scores_ACC1ag</span> <span class="o">=</span> <span class="n">gbclf4</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>                                                                                                                                                                                                                                               
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GB Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC1ag</span><span class="p">)</span>
<span class="n">scores_AUC1ag</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">gbclf4</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GB AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC1ag</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">gbclf4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)))</span>
<span class="n">gbgb2feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gbclf4</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">gbdata_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">gbgb2feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GB- gradientboosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>GB Acc: 0.962303664921466
GB AUC: 0.7842775559710922
Runtime: 0.4443197250366211
              precision    recall  f1-score   support

           0       0.86      0.96      0.91       421
           1       0.63      0.28      0.39        94

    accuracy                           0.84       515
   macro avg       0.75      0.62      0.65       515
weighted avg       0.82      0.84      0.81       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier use GB selected features , CV=10</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">rfclf2</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">rfclf2</span><span class="p">,</span> <span class="n">g_feature</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">scores_Acc7</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc7</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc7</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC7</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC7</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC7</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision7</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision7</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision7</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall7</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall7</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall7</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f17</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f17</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f17</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RandomForest Acc: 0.86 (+/- 0.02)
RandomForest AUC: 0.80 (+/- 0.11)
RandomForest precision: 0.78 (+/- 0.29)
RandomForest recall: 0.19 (+/- 0.13)
RandomForest F1 score: 0.29 (+/- 0.19)
CV Runtime: 7.482296705245972
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#undersampling</span>
<span class="n">rus</span> <span class="o">=</span> <span class="n">under_sampling</span><span class="o">.</span><span class="n">RandomUnderSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">under_train</span><span class="p">,</span> <span class="n">under_target</span> <span class="o">=</span> <span class="n">rus</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;undersample_target:&#39;</span><span class="p">,</span><span class="n">Counter</span><span class="p">(</span><span class="n">under_target</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>undersample_target: Counter({0: 143, 1: 143})
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#SMOTEENN</span>
<span class="kn">from</span> <span class="nn">imblearn.combine</span> <span class="k">import</span> <span class="n">SMOTEENN</span>
<span class="n">sme</span> <span class="o">=</span> <span class="n">SMOTEENN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">senn_train</span><span class="p">,</span><span class="n">senn_target</span> <span class="o">=</span> <span class="n">sme</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span><span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SMOTEENN_target:&#39;</span><span class="p">,</span><span class="n">Counter</span><span class="p">(</span><span class="n">senn_target</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>SMOTEENN_target: Counter({1: 629, 0: 435})
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier on Smote data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sgbtclf</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sgbtclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smote_train</span><span class="p">,</span><span class="n">smote_target</span><span class="p">)</span>
<span class="n">sgbtscores_ACC</span> <span class="o">=</span> <span class="n">sgbtclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting Acc:&#39;</span><span class="p">,</span> <span class="n">sgbtscores_ACC</span><span class="p">)</span>
<span class="n">sgbtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">sgbtclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting AUC:&#39;</span><span class="p">,</span> <span class="n">sgbtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">sgbtclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">sgb</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sgbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">sr</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sgb</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">sgbfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sgbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">sgbfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTE- GradientBoosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>GradientBoosting Acc: 0.8485436893203884
GradientBoosting AUC: 0.7890281497953202
Runtime: 1.1671810150146484
              precision    recall  f1-score   support

           0       0.87      0.96      0.91       421
           1       0.66      0.35      0.46        94

    accuracy                           0.85       515
   macro avg       0.76      0.66      0.69       515
weighted avg       0.83      0.85      0.83       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier on SMOTEENN data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">senngbtclf</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">senngbtclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">senn_train</span><span class="p">,</span><span class="n">senn_target</span><span class="p">)</span>
<span class="n">senngbtscores_ACC</span> <span class="o">=</span> <span class="n">senngbtclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting Acc:&#39;</span><span class="p">,</span> <span class="n">senngbtscores_ACC</span><span class="p">)</span>
<span class="n">senngbtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">senngbtclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting AUC:&#39;</span><span class="p">,</span> <span class="n">senngbtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">senngbtclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">sgb4</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">senngbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">sr4</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sgb4</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">senngbfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">senngbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">senngbfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTEENN- GradientBoosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>GradientBoosting Acc: 0.8135922330097087
GradientBoosting AUC: 0.773664527214838
Runtime: 0.6967320442199707
              precision    recall  f1-score   support

           0       0.88      0.90      0.89       421
           1       0.49      0.44      0.46        94

    accuracy                           0.81       515
   macro avg       0.68      0.67      0.67       515
weighted avg       0.81      0.81      0.81       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#GradientBoostingClassifier on undersampling data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">ungbtclf</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;deviance&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ungbtclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">under_train</span><span class="p">,</span><span class="n">under_target</span><span class="p">)</span>
<span class="n">ungbtscores_ACC</span> <span class="o">=</span> <span class="n">ungbtclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting Acc:&#39;</span><span class="p">,</span> <span class="n">ungbtscores_ACC</span><span class="p">)</span>
<span class="n">ungbtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">ungbtclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GradientBoosting AUC:&#39;</span><span class="p">,</span> <span class="n">ungbtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">ungbtclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">ugb</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ungbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">ur</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ugb</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">ungbfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ungbtclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">ungbfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Undersampling- GradientBoosting: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>GradientBoosting Acc: 0.7067961165048544
GradientBoosting AUC: 0.7894324556527013
Runtime: 0.2399430274963379
              precision    recall  f1-score   support

           0       0.92      0.70      0.80       421
           1       0.35      0.73      0.48        94

    accuracy                           0.71       515
   macro avg       0.64      0.72      0.64       515
weighted avg       0.82      0.71      0.74       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier use SMOTEENN data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">smnerclf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">smnerclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">senn_train</span><span class="p">,</span><span class="n">senn_target</span><span class="p">)</span>
<span class="n">smnescores_ACC</span> <span class="o">=</span> <span class="n">smnerclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest Acc:&#39;</span><span class="p">,</span> <span class="n">smnescores_ACC</span><span class="p">)</span>
<span class="n">smscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">smnerclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest AUC:&#39;</span><span class="p">,</span> <span class="n">smscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">smnerclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">smeena</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">smnerclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">smeena</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">smennrfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">smnerclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">smennrfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTEENN - RandomForest: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Random Forest Acc: 0.8
Random Forest AUC: 0.7327917319452166
Runtime: 0.3460965156555176
              precision    recall  f1-score   support

           0       0.87      0.89      0.88       421
           1       0.44      0.38      0.41        94

    accuracy                           0.80       515
   macro avg       0.66      0.64      0.65       515
weighted avg       0.79      0.80      0.79       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># RandomForestClassifier use undersampling data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">unrclf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">unrclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">under_train</span><span class="p">,</span><span class="n">under_target</span><span class="p">)</span>
<span class="n">unscores_ACC</span> <span class="o">=</span> <span class="n">unrclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest Acc:&#39;</span><span class="p">,</span> <span class="n">unscores_ACC</span><span class="p">)</span>
<span class="n">unscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">unrclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest AUC:&#39;</span><span class="p">,</span> <span class="n">unscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">unrclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">una</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unrclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">una</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">unrfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">unrclf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">unrfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Undersampling - RandomForest: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Random Forest Acc: 0.7281553398058253
Random Forest AUC: 0.7831404457472078
Runtime: 0.2487475872039795
              precision    recall  f1-score   support

           0       0.90      0.75      0.82       421
           1       0.36      0.65      0.47        94

    accuracy                           0.73       515
   macro avg       0.63      0.70      0.64       515
weighted avg       0.81      0.73      0.75       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#decision tree using gradientboosting selected features </span>
<span class="n">start_ts9</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clf_dt</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf_dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>
<span class="n">scores_ACC_dt</span> <span class="o">=</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC_dt</span><span class="p">)</span>
<span class="n">scores_AUC_dt</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC_dt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)))</span>

<span class="n">df5feat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf_dt</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">gbdata_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df5feat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GB-DecisionTree(gini): Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Decision Tree Acc: 0.9916230366492147
Decision Tree AUC: 0.5770708040632738
Runtime: 0.027438879013061523
              precision    recall  f1-score   support

           0       0.84      0.87      0.86       421
           1       0.32      0.28      0.30        94

    accuracy                           0.76       515
   macro avg       0.58      0.57      0.58       515
weighted avg       0.75      0.76      0.75       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#decision tree on SMOTEENN data</span>
<span class="n">start_ts10</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">smeclf_dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">smeclf_dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">senn_train</span><span class="p">,</span><span class="n">senn_target</span><span class="p">)</span>
<span class="n">senndtscores_ACC</span> <span class="o">=</span> <span class="n">smeclf_dt</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTree Acc:&#39;</span><span class="p">,</span> <span class="n">senndtscores_ACC</span><span class="p">)</span>
<span class="n">senndtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">smeclf_dt</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTree AUC:&#39;</span><span class="p">,</span> <span class="n">senndtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">smeclf_dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">sgb8</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">smeclf_dt</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">sr8</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sgb8</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">senndtfeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">smeclf_dt</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">senndtfeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SMOTEENN- decision tree: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>DecisionTree Acc: 0.7203883495145631
DecisionTree AUC: 0.5801915398999343
Runtime: 0.026927471160888672
              precision    recall  f1-score   support

           0       0.85      0.81      0.82       421
           1       0.28      0.34      0.31        94

    accuracy                           0.72       515
   macro avg       0.56      0.57      0.57       515
weighted avg       0.74      0.72      0.73       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#DecisionTree on undersampling data</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">undclf_dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">undclf_dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">under_train</span><span class="p">,</span><span class="n">under_target</span><span class="p">)</span>
<span class="n">undtscores_ACC</span> <span class="o">=</span> <span class="n">undclf_dt</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">target_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTree Acc:&#39;</span><span class="p">,</span> <span class="n">undtscores_ACC</span><span class="p">)</span>
<span class="n">undtscores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">undclf_dt</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DecisionTree AUC:&#39;</span><span class="p">,</span> <span class="n">undtscores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">undclf_dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data_test</span><span class="p">)))</span>
<span class="n">ugb</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">undclf_dt</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">ur</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ugb</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">undffeat_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">undclf_dt</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">undffeat_importances</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Undersampling- DecisionTree: Top 15 important features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>DecisionTree Acc: 0.5631067961165048
DecisionTree AUC: 0.5729772072572902
Runtime: 0.012966156005859375
              precision    recall  f1-score   support

           0       0.86      0.56      0.68       421
           1       0.23      0.60      0.33        94

    accuracy                           0.56       515
   macro avg       0.55      0.58      0.50       515
weighted avg       0.75      0.56      0.61       515

</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># AdaBoostClassifier using original(cv=10)</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">a_clf2</span><span class="o">=</span><span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">base_estimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">a_clf2</span><span class="p">,</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#print(scores)</span>
<span class="n">scores_Acc51</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc51</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc51</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC51</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC51</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC51</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">scores_precision51</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_precision&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting precision: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_precision51</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_precision51</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_recall51</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_recall&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting recall: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_recall51</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_recall51</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="n">scores_f151</span><span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_f1_score&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ada Boosting F1 score: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_f151</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_f151</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Ada Boosting Acc: 0.85 (+/- 0.02)
Ada Boosting AUC: 0.81 (+/- 0.11)
Ada Boosting precision: 0.90 (+/- 0.60)
Ada Boosting recall: 0.09 (+/- 0.13)
Ada Boosting F1 score: 0.16 (+/- 0.20)
CV Runtime: 7.167876720428467
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#MLPClassifier</span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">m_clf</span><span class="o">=</span><span class="n">MLPClassifier</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>  <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores4</span><span class="o">=</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">m_clf</span><span class="p">,</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="n">scorers2</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">scores_Acc55</span> <span class="o">=</span> <span class="n">scores4</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span>     
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Neural Network Acc: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_Acc55</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_Acc55</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>                                                                                                    
<span class="n">scores_AUC51</span><span class="o">=</span> <span class="n">scores4</span><span class="p">[</span><span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>                                                                   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Neural Network AUC: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores_AUC51</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores_AUC51</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV Runtime:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\neural_network\_multilayer_perceptron.py:470: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
  self.n_iter_ = _check_optimize_result(&quot;lbfgs&quot;, opt_res, self.max_iter)
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Neural Network Acc: 0.84 (+/- 0.01)
Neural Network AUC: 0.58 (+/- 0.11)
CV Runtime: 14.796015739440918
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\Shuya C\Anaconda3\envs\dsc478\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Using SVC on gradientboosting selected features </span>
<span class="n">start_ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">svmclf</span><span class="o">=</span><span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span><span class="n">probability</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
<span class="n">svmclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gbdata_train</span><span class="p">,</span> <span class="n">gbtarget_train</span><span class="p">)</span>
<span class="n">scores_ACC</span> <span class="o">=</span> <span class="n">svmclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">,</span> <span class="n">gbtarget_test</span><span class="p">)</span>                                                                                                                          
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVM Acc:&#39;</span><span class="p">,</span> <span class="n">scores_ACC</span><span class="p">)</span>
<span class="n">scores_AUC</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">svmclf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>         
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVM AUC:&#39;</span><span class="p">,</span> <span class="n">scores_AUC</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVM Run time:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">gbtarget_test</span><span class="p">,</span> <span class="n">svmclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gbdata_test</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>SVM Acc: 0.8252427184466019
SVM AUC: 0.7250972860969322
SVM Run time: 2367.896423816681
              precision    recall  f1-score   support

           0       0.83      0.99      0.90       421
           1       0.62      0.11      0.18        94

    accuracy                           0.83       515
   macro avg       0.73      0.55      0.54       515
weighted avg       0.79      0.83      0.77       515

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#undertraining</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="k">import</span> <span class="n">plot_tree</span>
<span class="kn">from</span> <span class="nn">matplotlib.pylab</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">model3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">under_train</span><span class="p">,</span><span class="n">under_target</span><span class="p">)</span>
<span class="c1"># plot single tree</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;tree1.png&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">graphviz</span> 
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">tree</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">unrclf3</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">unrclf3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">under_train</span><span class="p">,</span><span class="n">under_target</span><span class="p">)</span>
<span class="c1"># Extract single tree</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">unrclf3</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="k">import</span> <span class="n">export_graphviz</span>
<span class="c1"># Export as dot file</span>
<span class="n">dot_data</span><span class="o">=</span> <span class="n">export_graphviz</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span>  <span class="n">feature_names</span><span class="o">=</span><span class="n">under_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">graphviz</span> <span class="k">import</span> <span class="n">Source</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">dot_data</span><span class="p">)</span> 
<span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;tree3.png&quot;</span><span class="p">,</span><span class="n">view</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># Display in jupyter notebook</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;tree3.png&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[59]:</div>




<div class="output_png output_subarea output_execute_result">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[&#160;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    </div>
  </div>


 



<script type="text/javascript" src="/d2l/common/math/MathML.js?v=20.20.8.23830-324 "></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() { D2LMathML.DesktopInit('https://s.brightspace.com/lib/mathjax/2.7.4/MathJax.js?config=MML_HTMLorMML','https://s.brightspace.com/lib/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML','130'); });</script></body></html>